<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>å¢¨æ°´å°ä¾¿æ¡</title>
    <link rel="stylesheet" href="js/styles.css">
    <script src="js/wakelock.js"></script>
    <link rel="shortcut icon" href="js/zhao_128x128.ico">
</head>

<body>
    <svg width="0" height="0" style="position: absolute;">
        <filter id="embossFilter" x="0" y="0" width="100%" height="100%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="1.5" result="blur" />
            <feOffset in="blur" dx="2" dy="2" result="offsetBlur" />
            <feSpecularLighting in="blur" surfaceScale="5" specularConstant="0.75" specularExponent="20"
                lighting-color="#ffffff" result="specOut">
                <fePointLight id="dynamicLight" x="50" y="50" z="200" />
            </feSpecularLighting>
            <feComposite in="specOut" in2="SourceAlpha" operator="in" result="specOut" />
            <feMerge>
                <feMergeNode in="SourceGraphic" />
                <feMergeNode in="specOut" />
            </feMerge>
        </filter>
    </svg>

    <div id="grid-container">
        <div id="grid"></div>
        <div id="popup"></div>
    </div>
    <div class="text-container">
        <div class="ui-buttons">
            <div class="left-buttons" style="position: relative;">
                <button id="about-button">aj300542</button>
            </div>
            <div class="right-buttons" style="position: relative;">
                <button id="hanshi">å¯’é£Ÿå­—å¸–ç½‘ç«™</button>
                <button id="donate">æèµ </button>
            </div>
        </div>
        <input type="text" id="textInput" value="åƒè¨€ä¸‡è¯­" placeholder="è¯·è¾“å…¥æ–‡å­—â€¦" oninput="updateGrid()" autocomplete="off"
            autofocus />
        <div class="ui-buttons">

        </div>

    </div>
    <div class="containControls">
        <div id="controls">
            <button onclick="applyHardLightCanvas()">å¼ºå…‰</button>
            <button onclick="applyLuminosityCanvas()">æ˜åº¦</button>
            <button onclick="applyTransparency()">é€æ˜</button>
            <div class="color-picker-container" style="position: relative;">
                <button onclick="toggleScrollMenu()">å˜è‰² ğŸ¨</button>
                <div class="scroll-menu" id="scrollMenu">
                    <ul>
                        <li onclick="applyColorCanvas('crimson')">ç»¯çº¢</li>
                        <li onclick="applyColorCanvas('orange')">æ©™è‰²</li>
                        <li onclick="applyColorCanvas('salmon')">é²‘çº¢</li>
                        <li onclick="applyColorCanvas('teal')">é’ç»¿</li>
                        <li onclick="applyColorCanvas('navy')">è—é’</li>
                        <li onclick="applyColorCanvas('indigo')">é›è“</li>
                        <li onclick="applyColorCanvas('plum')">æ¢…ç´«</li>
                        <li onclick="applyColorCanvas('chocolate')">å·§å…‹åŠ›</li>
                        <li onclick="applyColorCanvas('coral')">çŠç‘š</li>
                        <li onclick="applyColorCanvas('khaki')">å¡å…¶</li>
                        <li onclick="applyColorCanvas('lavender')">è–°è¡£è‰</li>
                        <li onclick="applyColorCanvas('ivory')">è±¡ç‰™</li>
                        <li onclick="applyColorCanvas('slategray')">çŸ³æ¿ç°</li>
                        <li onclick="applyColorCanvas('darkcyan')">æ·±é’</li>
                        <li onclick="applyColorCanvas('lightpink')">æµ…ç²‰</li>

                    </ul>
                </div>
            </div>
            <div class="color-picker-wrapper">
                <select id="baseColorSelect" onchange="setBaseColor(this.value)">
                    <option value="#ffffff">ç™½è‰²</option>
                    <option value="#ddc80a">é²œé»„</option>
                    <option value="#00c4c4">é’è“</option>
                    <option value="#1a1a1a">æ·±ç°</option>
                    <option value="#009714">ç»¿è‹”</option>
                    <option value="#e6e6fa">é›ªé’</option>
                    <option value="#faebd7">æä»ç±³</option>
                    <option value="#708090">é’ç°</option>
                    <option value="#0f0f0f">å¢¨é»‘</option>
                    <option value="#006eff">å¤©è“</option>
                    <option value="#d2b48c">èŒ¶è¤</option>
                    <option value="#e3c9c9">è—•è·</option>
                    <option value="#ffe4e1">è”·è–‡ç²‰</option>
                    <option value="#ffdab9">èœœæ¡ƒæ©™</option>
                    <option value="#8fbc8f">è±†ç»¿</option>
                    <option value="#4682b4">é’¢è“</option>
                    <option value="#b0c4de">é›¾è“</option>
                    <option value="#dda0dd">æ·¡ç´«</option>
                    <option value="#bc8f8f">ç«ç‘°è¤</option>
                    <option value="#f4a460">æ²™æ£•</option>
                    <option value="#2f4f4f">å¢¨ç»¿</option>
                    <option value="#ffe4b5">å¥¶æ²¹é»„</option>
                    <option value="#c0c0c0">é“¶ç°</option>
                    <option value="#ffcccb">æŸ”ç²‰</option>
                    <option value="#9b0a00">çº¢å¢™</option>
                </select>
            </div>

            <button onclick="applyXuanWithEmboss()">å®£çº¸çº¹ç†</button>
            <button onclick="applyGrainWithEmboss()">é¢—ç²’è´¨æ„Ÿ</button>
            <button onclick="apply3dWithLight()">ç«‹ä½“å¢å¼º</button>
            <button onclick="runRandomEffect()">ğŸ•¹ï¸</button>

            <button id="startDemoBtn">â–¶ï¸â¸ï¸</button>
            <button id="stopDemoBtn">â¹</button>
            <input type="file" id="txtFileInput" accept=".txt">
            <div class="file-upload-wrapper">
                <button onclick="document.getElementById('txtFileInput').click()">åŠ è½½</button>
                <input type="file" id="txtFileInput" accept=".txt">

            </div>

            <button onclick="loadSample()">æ•…äº‹</button>
            <button onclick="enterFullscreen()">å…¨å±</button>
        </div>
    </div>
    <script>
        let currentBaseColor = "#ffffff";

        function setBaseColor(color) {
            currentBaseColor = color;
            console.log("åº•è‰²å·²è®¾ç½®ä¸ºï¼š", color);

            // æ›´æ–°æ‰€æœ‰å·²æ’å…¥çš„åº•è‰²å±‚
            document.querySelectorAll(".base-color-layer").forEach(layer => {
                layer.style.backgroundColor = currentBaseColor;
            });
        }

        function insertBaseLayer(cell) {
            const baseLayer = document.createElement("div");
            baseLayer.className = "base-color-layer";
            baseLayer.style.backgroundColor = currentBaseColor || "#fdf6e3";
            baseLayer.style.position = "absolute";
            baseLayer.style.top = "0";
            baseLayer.style.left = "0";
            baseLayer.style.width = "100%";
            baseLayer.style.height = "100%";
            baseLayer.style.zIndex = "0";

            cell.style.position = "relative";
            cell.appendChild(baseLayer);
        }

        const colorSelect = document.querySelector("select");
        let isHovering = false;

        function setBaseColor(color) {
            currentBaseColor = color;
            console.log("åº•è‰²å·²è®¾ç½®ä¸ºï¼š", color);
            document.querySelectorAll(".base-color-layer").forEach(layer => {
                layer.style.backgroundColor = currentBaseColor;
            });
        }

        function wheelHandler(e) {
            if (!isHovering) return; // âœ… åªæœ‰æ‚¬åœæ—¶æ‰è§¦å‘
            e.preventDefault();

            const options = Array.from(colorSelect.options);
            const currentIndex = colorSelect.selectedIndex;
            let nextIndex = currentIndex + (e.deltaY > 0 ? 1 : -1);

            if (nextIndex < 0) nextIndex = options.length - 1;
            if (nextIndex >= options.length) nextIndex = 0;

            colorSelect.selectedIndex = nextIndex;
            setBaseColor(options[nextIndex].value);
        }

        // âœ… åªç»‘å®šä¸€æ¬¡ wheelï¼Œå¹¶è®¾ç½® passive: false
        colorSelect.addEventListener("wheel", wheelHandler, { passive: false });

        // âœ… ç”¨æ‚¬åœçŠ¶æ€æ§åˆ¶è§¦å‘
        colorSelect.addEventListener("mouseenter", () => {
            isHovering = true;
        });
        colorSelect.addEventListener("mouseleave", () => {
            isHovering = false;
        });

    </script>
    <script>
        const colorList = [
            'crimson', 'orange', 'salmon', 'teal', 'navy', 'indigo',
            'plum', 'chocolate', 'coral', 'khaki', 'lavender',
            'ivory', 'slategray', 'darkcyan', 'lightpink'
        ];

        let currentColorIndex = 0;

        const colorButton = document.querySelector('.color-picker-container button');

        colorButton.addEventListener('mouseenter', () => {
            colorButton.addEventListener('wheel', handleWheelScroll);
        });

        colorButton.addEventListener('mouseleave', () => {
            colorButton.removeEventListener('wheel', handleWheelScroll);
        });

        function handleWheelScroll(e) {
            e.preventDefault();

            if (e.deltaY > 0) {
                currentColorIndex = (currentColorIndex + 1) % colorList.length;
            } else {
                currentColorIndex = (currentColorIndex - 1 + colorList.length) % colorList.length;
            }

            const selectedColor = colorList[currentColorIndex];
            applyColorCanvas(selectedColor);

            // å¯é€‰ï¼šæ›´æ–°æŒ‰é’®æ–‡å­—æˆ–æ˜¾ç¤ºé¢„è§ˆ
            colorButton.textContent = `å˜è‰² ğŸ¨ ${selectedColor}`;
        }

    </script>
    <script>
        function enterFullscreen() {
            const container = document.querySelector(".containControls");
            container.style.display = "none";
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            }
        }

        document.addEventListener("fullscreenchange", () => {
            const container = document.querySelector(".containControls");
            if (!document.fullscreenElement) {
                container.style.display = "flex";
            }
        });
        document.getElementById("about-button").addEventListener("click", () => {
            window.open("https://aj300542.github.io/", "_blank");
        });
        document.getElementById("donate").addEventListener("click", () => {
            window.open("https://aj300542.github.io/download.html", "_blank");
        });
        document.getElementById("hanshi").addEventListener("click", () => {
            window.open("https://aj300542.github.io/hanshi", "_blank");
        });
    </script>
    <script>


    </script>
    <script src="js/effect.js"></script>
    <script src="js/grid.js"></script>
    <script src="js/txt.js"></script>
    <script src="js/color.js"></script>
    <script src="js/play.js"></script>
</body>

</html>